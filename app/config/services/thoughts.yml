services:

    # feed

    app.thoughts.feed:
        class: 'Angelov\Donut\Thoughts\ThoughtsFeed\DoctrineThoughtsFeed'
        arguments: ['@doctrine.orm.entity_manager', '@app.users.security.current_user']


    # repositories

    app.thoughts.repositories.default: '@app.thoughts.repositories.doctrine'

    app.thoughts.repositories.doctrine:
        class: 'Angelov\Donut\Thoughts\Repositories\DoctrineThoughtsRepository'
        arguments: ['@doctrine.orm.entity_manager']


    # form

    app.thoughts.form.thought_type:
        class: 'Angelov\Donut\Thoughts\Form\ThoughtType'
        arguments: ['@app.users.security.current_user', '@app.core.uuid_generator']
        tags:
            - { name: 'form.type' }


    # thoughts counter

    app.thoughts.thoughts_counter.default: '@app.thoughts.thoughts_counter.ensuring_default_value'

    app.thoughts.thoughts_counter.redis:
        class: 'Angelov\Donut\Thoughts\ThoughtsCounter\RedisThoughtsCounter'
        arguments: ['@snc_redis.default']

    app.thoughts.thoughts_counter.logging:
        class: 'Angelov\Donut\Thoughts\ThoughtsCounter\LoggingThoughtsCounter'
        arguments: ['@app.thoughts.thoughts_counter.redis', '@logger']

    app.thoughts.thoughts_counter.ensuring_default_value:
        class: 'Angelov\Donut\Thoughts\ThoughtsCounter\EnsuringDefaultValueThoughtCounter'
        arguments: ['@app.thoughts.thoughts_counter.logging']

    app.thoughts.thoughts_counter.twig.exstension:
        class: 'Angelov\Donut\Thoughts\ThoughtsCounter\Twig\ThoughtsCounterExtension'
        arguments: ['@app.thoughts.thoughts_counter.default']
        tags:
            - { name: 'twig.extension' }


    # command handlers

    app.thoughts.handlers.store:
        class: 'Angelov\Donut\Thoughts\Handlers\StoreThoughtCommandHandler'
        arguments: ['@app.thoughts.repositories.default', '@app.core.event_bus.default']
        tags:
            - { name: 'command_handler', handles: 'Angelov\Donut\Thoughts\Commands\StoreThoughtCommand' }

    app.thoughts.handlers.delete:
        class: 'Angelov\Donut\Thoughts\Handlers\DeleteThoughtCommandHandler'
        arguments: ['@app.thoughts.repositories.default', '@app.core.event_bus.default']
        tags:
            - { name: 'command_handler', handles: 'Angelov\Donut\Thoughts\Commands\DeleteThoughtCommand' }


    # event subscribers

    app.thoughts.event_subscribers.increase_thoughts_number_for_user:
        class: 'Angelov\Donut\Thoughts\EventSubscribers\IncreaseThoughtsNumberForUser'
        arguments: ['@app.thoughts.thoughts_counter.default']
        tags:
            - { name: 'event_subscriber', subscribes_to: 'Angelov\Donut\Thoughts\Events\ThoughtWasPublishedEvent' }

    app.thoughts.event_subscribers.decrease_thoughts_number_for_user:
        class: 'Angelov\Donut\Thoughts\EventSubscribers\DecreaseThoughtsNumberForUser'
        arguments: ['@app.thoughts.thoughts_counter.default']
        tags:
            - { name: 'event_subscriber', subscribes_to: 'Angelov\Donut\Thoughts\Events\ThoughtWasDeletedEvent' }
